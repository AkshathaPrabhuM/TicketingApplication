@(tasks: List[Task], taskForm: Form[Task])

@import helper._

@main("Ticketing System") {
<div ng-app="myApp" ng-controller="customersCtrl">

	<div class="jumbotron">
    	<h1>Ticketing Application</h1>      
    	<p>Keeps track of customer complaints..</p>      
  	</div>
  	
  	
  	<div ng-show="@tasks.size() > 0">
    <h3>Available Tickets</h3>
    <h4>@tasks.size() tickets(s)</h4>
    
    <table class="table table-striped">
  		<thead>
    		<tr>
      			<th>Edit</th>
      			<th>Customer Name</th>
      			<th>Comments</th>
      			<th>Creator</th>
      			<th>Assignee</th>
      			<th>Status</th>
      			<th>Delete</th>
   			</tr>
 	 	</thead>
  		<tbody>
  			@for(task <- tasks) {
    		<tr>
      			<td style="width: 25%;">
        			&nbsp &nbsp 
        			<button class="btn btn-info" ng-click="editUser('assign', '@task.id', '@task.custName', '@task.comments', '@task.creator', '@task.assignee', '@task.status')">
          				<span class="glyphicon glyphicon-user"></span>  Assign
        			</button>
        			&nbsp &nbsp
        			<button class="btn btn-primary" ng-click="editUser('update', '@task.id', '@task.custName', '@task.comments', '@task.creator', '@task.assignee', '@task.status')">
          				<span class="glyphicon glyphicon-pencil"></span>  Update
        			</button>
      			</td>
      			<td>@task.custName</td>
      			<td>@task.comments</td>
      			<td>@task.creator</td>
      			<td>@task.assignee</td>
      			<td>@task.status</td>
      			<td>
      			<form class="form-horizontal" action="@routes.Application.deleteTask(task.id)" method="post">
        				<button class="btn btn-danger">
          					<span class="glyphicon glyphicon-minus-sign"></span> Delete 
        				</button>
        			</form>
      			</td>
    		</tr>
    		}
  		</tbody>
	</table>
	</div>
	
		&nbsp &nbsp
		<button class="btn btn-success" ng-show="isUpdate || isAssign" ng-click="createTicket()">
			<span class="glyphicon glyphicon-save"></span>  Create new Ticket
		</button>
    
    <div ng-show="isCreate">
    <h3>Create New Ticket:</h3>
	<form class="form-horizontal" action="@routes.Application.newTask()" method="post">
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Customer Name: </label>
    		<div class="col-sm-10">
    			<input type="text" class="form-control" name="custName" id="custName" ng-model="custName" value={{custName}} required>
    		</div>
  		</div> 
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Comments: </label>
    		<div class="col-sm-10">
    			<textarea class="form-control" name="comments" id="comments" ng-model="comments" value={{comments}} required></textarea>
    		</div>
  		</div>
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Created By: </label>
    		<div class="col-sm-10">
    			<input type="text" class="form-control" name="creator" id="creator" ng-model="creator" value={{creator}} required>
    		</div>
  		</div>
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Status: </label>
    		<div class="col-sm-10">
    			<select required name="status" id="status" ng-model="status" ng-init={{status}} class="form-control">
    			<option></option>
            		<option>New</option>
          		</select>
    		</div>
  		</div>
  		<center>
  		<button class="btn btn-success" ng-readonly="incomplete">
			<span class="glyphicon glyphicon-save"></span>  Submit Ticket
		</button>
		</center>
	</form>
	</div>
	
	<div ng-show="isUpdate || isAssign">
	<h3 ng-show="isUpdate">Update Ticket:</h3>
	<h3 ng-show="isAssign">Assign Ticket:</h3>
	<form class="form-horizontal" action="@routes.Application.updateTask()" method="post">
		<input type="text" name="id" ng-show="false" value ={{taskId}}>
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Customer Name: </label>
    		<div class="col-sm-10">
    			<input type="text" class="form-control" name="custName" id="custName" ng-model="custName" value={{custName}} readonly>
    		</div>
  		</div> 
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Comments: </label>
    		<div class="col-sm-10">
    			<textarea class="form-control" name="comments" id="comments" ng-model="comments" value={{comments}} ng-readonly="isTicketClosed" required></textarea>
    		</div>
  		</div>
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Created By: </label>
    		<div class="col-sm-10">
    			<input type="text" class="form-control" name="creator" id="creator" ng-model="creator" value={{creator}} readonly>
    		</div>
  		</div>
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Assigned To: </label>
    		<div class="col-sm-10">
    			<input type="text" class="form-control" name="assignee" id="assignee" ng-model="assignee" value={{assignee}} ng-readonly="isTicketClosed" required>
    		</div>
  		</div>
  		<div class="form-group">
    		<label class="col-sm-2 control-label">Status: </label>
    		<div class="col-sm-10">
    			<select required name="status" id="status" ng-model="status" class="form-control" ng-init={{status}} ng-readonly="isStatusDisabled">
    				<option>New</option>
            		<option>Open</option>
            		<option>Closed</option>
          		</select>
    		</div>
  		</div>
  		<center><button class="btn btn-success" ng-show="isUpdate" ng-disabled="isTicketClosed">
			<span class="glyphicon glyphicon-upload"></span>  Update Ticket
		</button></center>
		<center><button class="btn btn-success" ng-show="isAssign" ng-disabled="isTicketClosed">
			<span class="glyphicon glyphicon-user"></span>  Assign Ticket
		</button></center>
	</form>
	<br>
	<center><button class="btn btn-success" ng-show="isUpdate || isAssign" ng-click="createTicket()">
			<span class="glyphicon glyphicon-remove"></span>  Cancel
		</button></center>
	</div>
</div>    

<script>
angular.module('myApp', []).controller('customersCtrl', function($scope) {

$scope.isCreate=true;
$scope.isUpdate=false;
$scope.isAssign=false;

$scope.createTicket = function() {
$scope.isCreate=true;
$scope.isUpdate=false;
$scope.isAssign=false;
$scope.custName = "";
$scope.comments="";
$scope.creator = "";
$scope.assignee = "";
$scope.status = "";
};

$scope.editUser = function(action, id, custName, comments, creator, assignee, status) {
  if (action == 'update') 
  {
  	$scope.isUpdate =true;
  	$scope.isCreate=false;
	$scope.isAssign=false;
    $scope.taskId= id;
    $scope.custName = custName;
    $scope.comments=comments;
    $scope.creator = creator;
    $scope.assignee = assignee;
    $scope.status = status;
    $scope.isStatusDisabled=false;
    if(status=="Closed")
    {
    $scope.isStatusDisabled=true;
    }
  }
  else if(action=='assign')
  {
  	$scope.isAssign=true;
  	$scope.isCreate=false;
	$scope.isUpdate=false;
   	$scope.taskId= id;
    $scope.custName = custName;
    $scope.comments=comments;
    $scope.creator = creator;
    $scope.assignee = assignee;
    $scope.status = status;
    if(status!="Closed")
    {
    $scope.status = "Open";
    }
    $scope.isStatusDisabled=true;
  }
  
  $scope.isTicketClosed =false;
  if(status == 'Closed')
  {
  $scope.isTicketClosed =true;
  }
};
});

</script>
}
